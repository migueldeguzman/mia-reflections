# 09-01: REST API Audit and Compliance API Gateway

## Objective
Audit existing REST API coverage for all compliance functions and create a unified compliance API gateway router.

## Current State Analysis

### Existing Routes (from routes.setup.ts)

| Domain | Route | Status |
|--------|-------|--------|
| Compliance Portal | `/api/compliance-portal` | ✅ Exists (Phase 8) |
| E-Invoice Transmission | `/api/einvoice/transmission` | ✅ Exists (Phase 7) |
| E-Invoice Export | `/api/einvoice/export` | ✅ Exists (Phase 6) |
| Payroll/WPS | `/api/payroll` | ✅ Exists (Phase 5) |
| Finance/Tax Config | `/api/finance/compliance-config` | ✅ Exists (Phase 1) |
| Finance/Tax Categories | `/api/finance/tax-category` | ✅ Exists |
| Finance/Tax Configuration | `/api/finance/tax-configuration` | ✅ Exists |

### Existing Services Without Dedicated Routes

| Service | Location | Notes |
|---------|----------|-------|
| CT Calculation | `services/corporate-tax/ct-calculation.service.ts` | Needs routes |
| CT Report | `services/corporate-tax/ct-report.service.ts` | Needs routes |
| CT Adjustment | `services/corporate-tax/ct-adjustment.service.ts` | Needs routes |
| Transfer Pricing | `services/corporate-tax/transfer-pricing.service.ts` | Needs routes |
| Tax Group | `services/corporate-tax/tax-group.service.ts` | Needs routes |

## Implementation

### Task 1: Create Corporate Tax Routes

Create `routes/corporate-tax.routes.ts` to expose CT services:

```typescript
// Routes:
// GET  /api/corporate-tax/calculate/:fiscalYearId  - Calculate CT
// GET  /api/corporate-tax/report/:fiscalYearId     - Generate CT report
// GET  /api/corporate-tax/adjustments              - List adjustments
// POST /api/corporate-tax/adjustments              - Create adjustment
// GET  /api/corporate-tax/tax-groups               - List tax groups
// POST /api/corporate-tax/tax-groups               - Create tax group
```

### Task 2: Create Unified Compliance Gateway Router

Create `routes/compliance-api.routes.ts` that aggregates all compliance routes under a single prefix for standalone deployment:

```
/api/v1/compliance/
├── /portal/*        → compliance-portal.routes
├── /vat/*           → finance/tax-* routes  
├── /corporate-tax/* → corporate-tax.routes
├── /wps/*           → payroll.routes
├── /einvoice/*      → einvoice-*.routes
└── /config/*        → compliance-config.routes
```

### Task 3: Register New Routes

Update `setup/routes.setup.ts` to include:
- Corporate Tax routes
- Unified Compliance API gateway (optional, for API versioning)

## Files to Create/Modify

| File | Action |
|------|--------|
| `routes/corporate-tax.routes.ts` | CREATE |
| `controllers/corporate-tax.controller.ts` | CREATE |
| `setup/routes.setup.ts` | MODIFY |
| `config/types.ts` | MODIFY (add CT controller symbol) |
| `config/container.ts` | MODIFY (bind CT controller) |

## Success Criteria

1. All corporate tax services accessible via REST
2. Routes follow existing patterns (auth, permissions)
3. Existing routes unchanged (backward compatible)
