---
phase: 05-wps-payroll-compliance
plan: 06
type: execute
wave: 3
depends_on: ["05-01", "05-05"]
files_modified:
  - web-erp-app/backend/src/services/payroll/wps-error.service.ts
  - web-erp-app/backend/src/types/payroll/wps-error-codes.ts
autonomous: true

must_haves:
  truths:
    - "WPS errors captured with MOHRE error codes"
    - "Error resolution workflow tracks who resolved and how"
    - "Resolution guidance provided for common error codes"
    - "Errors linked to specific employees when applicable"
    - "Error history queryable for audit purposes"
  artifacts:
    - path: "web-erp-app/backend/src/services/payroll/wps-error.service.ts"
      provides: "WPS error tracking and resolution service"
      exports: ["WpsErrorService", "recordWpsError", "resolveError", "getResolutionGuidance"]
    - path: "web-erp-app/backend/src/types/payroll/wps-error-codes.ts"
      provides: "WPS error code definitions and resolution guidance"
      exports: ["WPS_ERROR_CODES", "getErrorCodeInfo"]
  key_links:
    - from: "wps-error.service.ts"
      to: "WpsError model"
      via: "Prisma operations"
      pattern: "prisma\\.wpsError\\."
    - from: "wps-error.service.ts"
      to: "ComplianceAuditService"
      via: "audit logging"
      pattern: "ComplianceAuditService"
---

<objective>
Create WPS error tracking and resolution service with MOHRE error code definitions and resolution guidance.

Purpose: WPS-05 (WPS error tracking and resolution) - Capture, track, and resolve WPS submission errors with specific error codes and guidance.

Output: WpsErrorService with error recording, resolution workflow, and error code reference.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-wps-payroll-compliance/05-RESEARCH.md
@.planning/phases/05-wps-payroll-compliance/05-01-SUMMARY.md
@.planning/phases/05-wps-payroll-compliance/05-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WPS error codes reference</name>
  <files>web-erp-app/backend/src/types/payroll/wps-error-codes.ts</files>
  <action>
Create comprehensive WPS error code definitions with resolution guidance:

```typescript
/**
 * WPS Error Codes Reference
 *
 * Common MOHRE/WPS error codes and resolution guidance.
 * These codes are returned when SIF files are rejected.
 *
 * Sources:
 * - MOHRE WPS documentation
 * - Bank WPS agent guides
 * - Common rejection patterns
 *
 * @module wps-error-codes
 */

// ============================================
// ERROR SEVERITY
// ============================================

export enum WpsErrorSeverity {
  ERROR = 'ERROR',       // Prevents processing, must be fixed
  WARNING = 'WARNING',   // May cause issues, should review
  INFO = 'INFO',         // Informational, no action required
}

// ============================================
// ERROR CATEGORIES
// ============================================

export enum WpsErrorCategory {
  FILE_FORMAT = 'FILE_FORMAT',           // SIF file structure errors
  EMPLOYER = 'EMPLOYER',                 // Employer/establishment errors
  EMPLOYEE = 'EMPLOYEE',                 // Employee record errors
  BANK = 'BANK',                         // Banking/IBAN errors
  AMOUNT = 'AMOUNT',                     // Salary amount errors
  DATE = 'DATE',                         // Date/period errors
  CONTRACT = 'CONTRACT',                 // Contract/visa errors
  DUPLICATE = 'DUPLICATE',               // Duplicate record errors
  SYSTEM = 'SYSTEM',                     // WPS system errors
}

// ============================================
// ERROR CODE INTERFACE
// ============================================

export interface WpsErrorCodeInfo {
  code: string;
  description: string;
  category: WpsErrorCategory;
  severity: WpsErrorSeverity;
  resolutionSteps: string[];
  commonCauses: string[];
  affectsField?: string;
}

// ============================================
// ERROR CODES DATABASE
// ============================================

export const WPS_ERROR_CODES: Record<string, WpsErrorCodeInfo> = {
  // File Format Errors (FF-xxx)
  'FF-001': {
    code: 'FF-001',
    description: 'Invalid SIF file name format',
    category: WpsErrorCategory.FILE_FORMAT,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Verify file name follows format: EEEEEEEEEEEEEYYMMDDHHMMSS.SIF',
      'Check employer ID is 13 digits with leading zeros',
      'Ensure timestamp matches file creation time',
    ],
    commonCauses: [
      'Missing leading zeros in employer ID',
      'File name timestamp mismatch with SCR record',
      'Invalid file extension (must be .SIF)',
    ],
    affectsField: 'fileName',
  },
  'FF-002': {
    code: 'FF-002',
    description: 'Missing or invalid SCR record',
    category: WpsErrorCategory.FILE_FORMAT,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Ensure SCR record is the last row in file',
      'Verify all SCR fields are present',
      'Check record count matches actual EDR count',
    ],
    commonCauses: [
      'SCR record not at end of file',
      'Record count mismatch',
      'Missing required SCR fields',
    ],
  },
  'FF-003': {
    code: 'FF-003',
    description: 'EDR record count mismatch',
    category: WpsErrorCategory.FILE_FORMAT,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Count EDR records in file',
      'Update SCR record count field',
      'Regenerate SIF file',
    ],
    commonCauses: [
      'Manual editing of SIF file',
      'Incomplete file generation',
    ],
  },
  'FF-004': {
    code: 'FF-004',
    description: 'Total amount mismatch',
    category: WpsErrorCategory.FILE_FORMAT,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Recalculate sum of all EDR salaries',
      'Update SCR total amount field',
      'Verify no rounding errors',
    ],
    commonCauses: [
      'Rounding errors in salary calculations',
      'Manual editing of SIF file',
    ],
    affectsField: 'totalAmount',
  },

  // Employer Errors (EM-xxx)
  'EM-001': {
    code: 'EM-001',
    description: 'Invalid MOL establishment ID',
    category: WpsErrorCategory.EMPLOYER,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Verify establishment ID in company WPS configuration',
      'Check ID matches MOHRE registration',
      'Contact MOHRE if ID was recently changed',
    ],
    commonCauses: [
      'Incorrect establishment ID entered',
      'Company not registered with WPS',
      'Establishment ID recently changed',
    ],
    affectsField: 'molEstablishmentId',
  },
  'EM-002': {
    code: 'EM-002',
    description: 'Employer WPS registration expired',
    category: WpsErrorCategory.EMPLOYER,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Check WPS registration status in MOHRE portal',
      'Renew WPS registration if expired',
      'Contact MOHRE for registration issues',
    ],
    commonCauses: [
      'Annual WPS registration not renewed',
      'License expired',
    ],
  },
  'EM-003': {
    code: 'EM-003',
    description: 'Invalid employer bank routing code',
    category: WpsErrorCategory.EMPLOYER,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Verify WPS agent routing code',
      'Contact bank to confirm routing code',
      'Update company WPS configuration',
    ],
    commonCauses: [
      'Outdated routing code',
      'Bank changed WPS agent details',
    ],
    affectsField: 'employerRoutingCode',
  },

  // Employee Errors (EE-xxx)
  'EE-001': {
    code: 'EE-001',
    description: 'Invalid person code',
    category: WpsErrorCategory.EMPLOYEE,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Verify person code is 14 digits',
      'Check against employee visa/labor card',
      'Contact MOHRE if person code invalid',
    ],
    commonCauses: [
      'Missing leading zeros',
      'Incorrect person code entered',
      'Employee not registered in MOHRE system',
    ],
    affectsField: 'personCode',
  },
  'EE-002': {
    code: 'EE-002',
    description: 'Employee not found in MOHRE database',
    category: WpsErrorCategory.EMPLOYEE,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Verify employee visa status is active',
      'Check labor contract is registered with MOHRE',
      'Wait 24-48 hours for new employees to sync',
    ],
    commonCauses: [
      'New employee not yet in MOHRE system',
      'Employee visa expired',
      'Labor contract not registered',
    ],
    affectsField: 'personCode',
  },
  'EE-003': {
    code: 'EE-003',
    description: 'Employee contract expired',
    category: WpsErrorCategory.CONTRACT,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Check labor contract expiry date',
      'Renew contract in MOHRE system',
      'Wait for renewal to be reflected',
    ],
    commonCauses: [
      'Contract not renewed',
      'Renewal pending processing',
    ],
    affectsField: 'personCode',
  },

  // Bank Errors (BK-xxx)
  'BK-001': {
    code: 'BK-001',
    description: 'Invalid IBAN format',
    category: WpsErrorCategory.BANK,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Verify IBAN is 23 characters',
      'Check IBAN starts with AE',
      'Validate IBAN checksum',
    ],
    commonCauses: [
      'Typo in IBAN entry',
      'Missing digits',
      'Non-UAE IBAN',
    ],
    affectsField: 'iban',
  },
  'BK-002': {
    code: 'BK-002',
    description: 'IBAN account not found or closed',
    category: WpsErrorCategory.BANK,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Verify account is active with bank',
      'Get updated IBAN from employee',
      'Check bank statements for recent activity',
    ],
    commonCauses: [
      'Account closed',
      'Employee changed banks',
      'Dormant account',
    ],
    affectsField: 'iban',
  },
  'BK-003': {
    code: 'BK-003',
    description: 'Invalid bank routing code',
    category: WpsErrorCategory.BANK,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Verify routing code is 9 digits',
      'Check routing code against bank\'s WPS agent',
      'Update WPS agents reference data',
    ],
    commonCauses: [
      'Outdated routing code',
      'Bank code and routing code mismatch',
    ],
    affectsField: 'bankRoutingCode',
  },
  'BK-004': {
    code: 'BK-004',
    description: 'Bank not registered as WPS agent',
    category: WpsErrorCategory.BANK,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Verify bank is WPS-registered',
      'Employee may need account at WPS-registered bank',
      'Check CBUAE list of approved WPS agents',
    ],
    commonCauses: [
      'Foreign bank without WPS registration',
      'New bank not yet WPS-approved',
    ],
  },

  // Amount Errors (AM-xxx)
  'AM-001': {
    code: 'AM-001',
    description: 'Salary below minimum wage',
    category: WpsErrorCategory.AMOUNT,
    severity: WpsErrorSeverity.WARNING,
    resolutionSteps: [
      'Verify salary amount is correct',
      'Check if employee is part-time (prorated)',
      'Review labor contract for agreed salary',
    ],
    commonCauses: [
      'Part-time employee calculation error',
      'Data entry error',
      'Unpaid leave not accounted',
    ],
    affectsField: 'netSalary',
  },
  'AM-002': {
    code: 'AM-002',
    description: 'Salary significantly different from contract',
    category: WpsErrorCategory.AMOUNT,
    severity: WpsErrorSeverity.WARNING,
    resolutionSteps: [
      'Verify salary matches labor contract',
      'If salary increased, update MOHRE contract',
      'Document reason for variance',
    ],
    commonCauses: [
      'Salary increased but contract not updated',
      'Variable pay components',
      'Deductions not properly reflected',
    ],
    affectsField: 'netSalary',
  },
  'AM-003': {
    code: 'AM-003',
    description: 'Invalid amount format',
    category: WpsErrorCategory.AMOUNT,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Remove commas from amount',
      'Ensure exactly 2 decimal places',
      'Use positive amounts only',
    ],
    commonCauses: [
      'Commas in amount (1,234.56)',
      'More than 2 decimal places',
      'Negative amount',
    ],
    affectsField: 'netSalary',
  },

  // Date Errors (DT-xxx)
  'DT-001': {
    code: 'DT-001',
    description: 'Invalid pay period dates',
    category: WpsErrorCategory.DATE,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Verify start date is before end date',
      'Check dates are in current or recent month',
      'Use YYYY-MM-DD format',
    ],
    commonCauses: [
      'End date before start date',
      'Future dates',
      'Invalid date format',
    ],
    affectsField: 'payPeriod',
  },
  'DT-002': {
    code: 'DT-002',
    description: 'Duplicate payment for period',
    category: WpsErrorCategory.DUPLICATE,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Check if salary already paid for this period',
      'Verify no duplicate submissions',
      'Contact WPS agent if incorrect',
    ],
    commonCauses: [
      'Double submission',
      'Overlapping pay periods',
    ],
  },

  // System Errors (SY-xxx)
  'SY-001': {
    code: 'SY-001',
    description: 'WPS system temporarily unavailable',
    category: WpsErrorCategory.SYSTEM,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Wait and retry submission',
      'Check MOHRE system status',
      'Contact WPS agent support',
    ],
    commonCauses: [
      'System maintenance',
      'High load periods',
    ],
  },
  'SY-002': {
    code: 'SY-002',
    description: 'File upload timeout',
    category: WpsErrorCategory.SYSTEM,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: [
      'Reduce file size if possible',
      'Retry during off-peak hours',
      'Split into multiple submissions',
    ],
    commonCauses: [
      'Large file with many employees',
      'Network issues',
    ],
  },
};

/**
 * Get error code information
 *
 * @param code - WPS error code
 * @returns Error code info or default unknown error
 */
export function getErrorCodeInfo(code: string): WpsErrorCodeInfo {
  return WPS_ERROR_CODES[code] || {
    code,
    description: 'Unknown error code',
    category: WpsErrorCategory.SYSTEM,
    severity: WpsErrorSeverity.ERROR,
    resolutionSteps: ['Contact support for assistance'],
    commonCauses: ['Unknown error'],
  };
}

/**
 * Get all error codes for a category
 */
export function getErrorCodesByCategory(
  category: WpsErrorCategory
): WpsErrorCodeInfo[] {
  return Object.values(WPS_ERROR_CODES).filter(e => e.category === category);
}

/**
 * Search error codes by keyword
 */
export function searchErrorCodes(keyword: string): WpsErrorCodeInfo[] {
  const lowerKeyword = keyword.toLowerCase();
  return Object.values(WPS_ERROR_CODES).filter(
    e =>
      e.code.toLowerCase().includes(lowerKeyword) ||
      e.description.toLowerCase().includes(lowerKeyword) ||
      e.resolutionSteps.some(s => s.toLowerCase().includes(lowerKeyword))
  );
}
```
  </action>
  <verify>
    - `npx tsc --noEmit` compiles successfully
    - getErrorCodeInfo returns error info or default
    - All error codes have resolution steps
  </verify>
  <done>WPS error codes reference with resolution guidance</done>
</task>

<task type="auto">
  <name>Task 2: Create WpsErrorService</name>
  <files>web-erp-app/backend/src/services/payroll/wps-error.service.ts</files>
  <action>
Create WpsErrorService for error tracking and resolution:

```typescript
/**
 * WPS Error Service
 *
 * Tracks and manages WPS submission errors.
 * Provides resolution guidance and error history.
 *
 * WPS-05: WPS error tracking and resolution
 *
 * @module WpsErrorService
 */

import { PrismaClient } from '@prisma/client';
import { injectable, inject } from 'inversify';
import { TYPES } from '../../config/types';
import logger from '../logger.service';
import {
  WpsErrorSeverity,
  WpsErrorCategory,
  WpsErrorCodeInfo,
  getErrorCodeInfo,
  getErrorCodesByCategory,
  searchErrorCodes,
} from '../../types/payroll/wps-error-codes';

// ============================================
// TYPES
// ============================================

export interface WpsErrorContext {
  companyId: string;
  userId: string;
}

export interface RecordErrorInput {
  submissionId: string;
  errorCode: string;
  errorMessage: string;
  field?: string;
  employeeId?: string;
  personCode?: string;
  severity?: WpsErrorSeverity;
}

export interface ResolveErrorInput {
  resolution: string;
}

export interface WpsErrorRecord {
  id: string;
  submissionId: string;
  errorCode: string;
  errorMessage: string;
  field: string | null;
  employeeId: string | null;
  personCode: string | null;
  severity: string;
  isResolved: boolean;
  resolvedAt: Date | null;
  resolvedById: string | null;
  resolution: string | null;
  createdAt: Date;
  // Enriched fields
  errorInfo?: WpsErrorCodeInfo;
}

// ============================================
// SERVICE
// ============================================

@injectable()
export class WpsErrorService {
  constructor(
    @inject(TYPES.PrismaClient) private prisma: PrismaClient
  ) {}

  /**
   * Record a WPS error
   *
   * @param context - User context
   * @param input - Error details
   * @returns Created error record
   */
  async recordError(
    context: WpsErrorContext,
    input: RecordErrorInput
  ): Promise<WpsErrorRecord> {
    // Verify submission belongs to company
    const submission = await this.prisma.wpsSubmission.findUnique({
      where: { id: input.submissionId },
    });

    if (!submission || submission.companyId !== context.companyId) {
      throw new Error('WPS submission not found or access denied');
    }

    // Get error code info for enrichment
    const errorInfo = getErrorCodeInfo(input.errorCode);

    const error = await this.prisma.wpsError.create({
      data: {
        submissionId: input.submissionId,
        errorCode: input.errorCode,
        errorMessage: input.errorMessage,
        field: input.field || errorInfo.affectsField || null,
        employeeId: input.employeeId,
        personCode: input.personCode,
        severity: input.severity || errorInfo.severity,
      },
    });

    logger.audit('[WpsError] Error recorded', {
      userId: context.userId,
      companyId: context.companyId,
      submissionId: input.submissionId,
      errorCode: input.errorCode,
    });

    return {
      ...error,
      errorInfo,
    };
  }

  /**
   * Record multiple errors at once
   *
   * @param context - User context
   * @param submissionId - Submission ID
   * @param errors - Array of error inputs
   * @returns Created error records
   */
  async recordErrors(
    context: WpsErrorContext,
    submissionId: string,
    errors: Omit<RecordErrorInput, 'submissionId'>[]
  ): Promise<WpsErrorRecord[]> {
    // Verify submission belongs to company
    const submission = await this.prisma.wpsSubmission.findUnique({
      where: { id: submissionId },
    });

    if (!submission || submission.companyId !== context.companyId) {
      throw new Error('WPS submission not found or access denied');
    }

    const records: WpsErrorRecord[] = [];

    for (const error of errors) {
      const errorInfo = getErrorCodeInfo(error.errorCode);

      const created = await this.prisma.wpsError.create({
        data: {
          submissionId,
          errorCode: error.errorCode,
          errorMessage: error.errorMessage,
          field: error.field || errorInfo.affectsField || null,
          employeeId: error.employeeId,
          personCode: error.personCode,
          severity: error.severity || errorInfo.severity,
        },
      });

      records.push({ ...created, errorInfo });
    }

    logger.audit('[WpsError] Multiple errors recorded', {
      userId: context.userId,
      companyId: context.companyId,
      submissionId,
      errorCount: errors.length,
    });

    return records;
  }

  /**
   * Resolve an error
   *
   * @param context - User context
   * @param errorId - Error ID
   * @param input - Resolution details
   * @returns Updated error record
   */
  async resolveError(
    context: WpsErrorContext,
    errorId: string,
    input: ResolveErrorInput
  ): Promise<WpsErrorRecord> {
    // Verify error exists and belongs to company
    const error = await this.prisma.wpsError.findUnique({
      where: { id: errorId },
      include: {
        submission: true,
      },
    });

    if (!error) {
      throw new Error('WPS error not found');
    }

    if (error.submission.companyId !== context.companyId) {
      throw new Error('Access denied');
    }

    if (error.isResolved) {
      throw new Error('Error already resolved');
    }

    const updated = await this.prisma.wpsError.update({
      where: { id: errorId },
      data: {
        isResolved: true,
        resolvedAt: new Date(),
        resolvedById: context.userId,
        resolution: input.resolution,
      },
    });

    logger.audit('[WpsError] Error resolved', {
      userId: context.userId,
      companyId: context.companyId,
      errorId,
      resolution: input.resolution,
    });

    return {
      ...updated,
      errorInfo: getErrorCodeInfo(updated.errorCode),
    };
  }

  /**
   * Get errors for a submission
   *
   * @param context - User context
   * @param submissionId - Submission ID
   * @param options - Filter options
   * @returns Array of error records
   */
  async getSubmissionErrors(
    context: WpsErrorContext,
    submissionId: string,
    options: { includeResolved?: boolean; severity?: WpsErrorSeverity } = {}
  ): Promise<WpsErrorRecord[]> {
    const submission = await this.prisma.wpsSubmission.findUnique({
      where: { id: submissionId },
    });

    if (!submission || submission.companyId !== context.companyId) {
      throw new Error('WPS submission not found or access denied');
    }

    const where: any = { submissionId };
    if (!options.includeResolved) {
      where.isResolved = false;
    }
    if (options.severity) {
      where.severity = options.severity;
    }

    const errors = await this.prisma.wpsError.findMany({
      where,
      orderBy: [
        { severity: 'desc' }, // ERROR first, then WARNING, then INFO
        { createdAt: 'asc' },
      ],
    });

    return errors.map(e => ({
      ...e,
      errorInfo: getErrorCodeInfo(e.errorCode),
    }));
  }

  /**
   * Get unresolved errors for employee
   *
   * @param context - User context
   * @param employeeId - Employee ID
   * @returns Array of unresolved errors
   */
  async getEmployeeErrors(
    context: WpsErrorContext,
    employeeId: string
  ): Promise<WpsErrorRecord[]> {
    const errors = await this.prisma.wpsError.findMany({
      where: {
        employeeId,
        isResolved: false,
        submission: {
          companyId: context.companyId,
        },
      },
      include: {
        submission: true,
      },
      orderBy: { createdAt: 'desc' },
    });

    return errors.map(e => ({
      ...e,
      errorInfo: getErrorCodeInfo(e.errorCode),
    }));
  }

  /**
   * Get error statistics for company
   *
   * @param context - User context
   * @returns Error statistics
   */
  async getErrorStatistics(context: WpsErrorContext): Promise<{
    total: number;
    unresolved: number;
    bySeverity: Record<string, number>;
    byCategory: Record<string, number>;
    topErrorCodes: Array<{ code: string; count: number }>;
  }> {
    const allErrors = await this.prisma.wpsError.findMany({
      where: {
        submission: {
          companyId: context.companyId,
        },
      },
    });

    const unresolved = allErrors.filter(e => !e.isResolved).length;

    // Count by severity
    const bySeverity: Record<string, number> = {};
    for (const error of allErrors) {
      bySeverity[error.severity] = (bySeverity[error.severity] || 0) + 1;
    }

    // Count by category
    const byCategory: Record<string, number> = {};
    for (const error of allErrors) {
      const info = getErrorCodeInfo(error.errorCode);
      byCategory[info.category] = (byCategory[info.category] || 0) + 1;
    }

    // Top error codes
    const codeCounts: Record<string, number> = {};
    for (const error of allErrors) {
      codeCounts[error.errorCode] = (codeCounts[error.errorCode] || 0) + 1;
    }
    const topErrorCodes = Object.entries(codeCounts)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 10)
      .map(([code, count]) => ({ code, count }));

    return {
      total: allErrors.length,
      unresolved,
      bySeverity,
      byCategory,
      topErrorCodes,
    };
  }

  /**
   * Get resolution guidance for error code
   *
   * @param errorCode - WPS error code
   * @returns Error code info with resolution steps
   */
  getResolutionGuidance(errorCode: string): WpsErrorCodeInfo {
    return getErrorCodeInfo(errorCode);
  }

  /**
   * Search error codes
   *
   * @param keyword - Search keyword
   * @returns Matching error code infos
   */
  searchErrorCodes(keyword: string): WpsErrorCodeInfo[] {
    return searchErrorCodes(keyword);
  }

  /**
   * Get errors by category
   *
   * @param category - Error category
   * @returns Error code infos in category
   */
  getErrorsByCategory(category: WpsErrorCategory): WpsErrorCodeInfo[] {
    return getErrorCodesByCategory(category);
  }
}
```
  </action>
  <verify>
    - `npx tsc --noEmit` compiles successfully
    - recordError creates error with enriched info
    - resolveError marks error as resolved with timestamp
    - getResolutionGuidance returns steps for error code
  </verify>
  <done>WpsErrorService with full error tracking and resolution workflow</done>
</task>

<task type="auto">
  <name>Task 3: Register WpsErrorService in DI container</name>
  <files>web-erp-app/backend/src/config/types.ts, web-erp-app/backend/src/config/container.ts</files>
  <action>
1. Add WpsErrorService symbol to types.ts:
   ```typescript
   WpsErrorService: Symbol.for('WpsErrorService'),
   ```

2. Register in container.ts:
   ```typescript
   import { WpsErrorService } from '../services/payroll/wps-error.service';

   container.bind<WpsErrorService>(TYPES.WpsErrorService)
     .to(WpsErrorService)
     .inSingletonScope();
   ```
  </action>
  <verify>
    - Service resolves from container
    - No circular dependency errors
  </verify>
  <done>WpsErrorService registered in DI container</done>
</task>

</tasks>

<verification>
1. Error codes defined: 20+ error codes with resolution steps
2. Service compiles: `npx tsc --noEmit`
3. Error recording works: recordError creates entry with enriched info
4. Resolution workflow: resolveError marks as resolved with user and timestamp
5. Error lookup: getErrorCodeInfo returns info for known codes, default for unknown
6. Statistics: getErrorStatistics returns counts by severity and category
</verification>

<success_criteria>
1. WPS error codes defined with MOHRE error code format (category-number)
2. Each error code has description, category, severity, resolution steps, common causes
3. WpsErrorService.recordError captures errors linked to submission and optionally employee
4. WpsErrorService.resolveError tracks who resolved and how
5. Resolution guidance available via getResolutionGuidance
6. Error statistics for company-level reporting
7. Search functionality to find relevant error codes
</success_criteria>

<output>
After completion, create `.planning/phases/05-wps-payroll-compliance/05-06-SUMMARY.md`
</output>
